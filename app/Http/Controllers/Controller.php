<?php

namespace App\Http\Controllers;

use App\Models\Admin;
use App\Models\Bot;
use App\Models\Branch;
use App\Models\BranchTransaction;
use App\Models\Brand;
use App\Models\Order;
use App\Models\ControlUser;
use Carbon\Carbon;
use Illuminate\Foundation\Auth\Access\AuthorizesRequests;
use Illuminate\Foundation\Bus\DispatchesJobs;
use Illuminate\Foundation\Validation\ValidatesRequests;
use Illuminate\Routing\Controller as BaseController;
use OpenApi\Attributes as OA;
use GuzzleHttp;


class Controller extends BaseController
{
    use AuthorizesRequests, DispatchesJobs, ValidatesRequests;

    const API_ACCESS_KEY = "AAAAmI_WKtU:APA91bF5yR0P0skvVBfXejbeeyAR8rqPeEyTS6TdlI_2Tcy--jWWu1rpoHHb6Hz2fwj5Dg9hqOUTASkvBxJ7LD00Jlv29b98cAOvxvwzZODn4sz-18Z1lxClBMdSADZFkvyLwdWY2fVR";
    const BOT_TOKEN = '6097681279:AAE8wpKF7lFuUQAnNv8z4ReTHIR1a2tWuHQ';
    const MAIN_BOT_TOKEN = '6263208402:AAFB9DQIOlBEz3N4tpckRJqDRbS-Npzsst8';

    const BOT_BASE_URL = 'https://expressfood.uz/botexpressfood/';
    const BASE_URL = 'https://expressfood.uz/';
    const BRAND_BASE_URL = 'http://brand.expressfood.uz/';
    const CLIENT_BASE_URL = 'http://client.expressfood.uz/';
    const SOCKET_BASE_URL = 'http://socket.expressfood.uz:4006/';

//    errors
    const AD_MESSAGE = [
        'uz' => "E'lon mavjud emas!",
        'ru' => "–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π!",
        'en' => "No ad available!",
    ];
    const USER_NOT_MESSAGE = [
        'uz' => "Brend mavjud emas!",
        'ru' => "–ú–∞—Ä–∫–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!",
        'en' => "Brand does not exist!",
    ];
    const USER_NOT_ALLOW_MESSAGE = [
        'uz' => "Ruxsat berilmagan brend!",
        'ru' => "–ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –±—Ä–µ–Ω–¥!",
        'en' => "Unauthorized brand!",
    ];
    const ADD_ADDRESS_MESSAGE = [
        'uz' => "Manzil qo'shildi!",
        'ru' => "–ê–¥—Ä–µ—Å –¥–æ–±–∞–≤–ª–µ–Ω!",
        'en' => "Address added!",
    ];
    const NOT_ADDRESS_MESSAGE = [
        'uz' => "Manzilni kiriting!",
        'ru' => "–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å!",
        'en' => "Enter the address!",
    ];
    const UPDATE_ADDRESS_MESSAGE = [
        'uz' => "Manzil o'zgartirildi!",
        'ru' => "–ê–¥—Ä–µ—Å –∏–∑–º–µ–Ω–µ–Ω!",
        'en' => "The address has been changed!",
    ];
    const DELETE_ADDRESS_MESSAGE = [
        'uz' => "Manzil o'chirilidi!",
        'ru' => "–ê–¥—Ä–µ—Å —É–¥–∞–ª–µ–Ω!",
        'en' => "Address removed!",
    ];
    const NOT_PRODUCT_MESSAGE = [
        'uz' => "Mahsulot mavjud emas!",
        'ru' => "–¢–æ–≤–∞—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω!",
        'en' => "Product not available!",
    ];
    const ADD_PRODUCT_FAVORTE_MESSAGE = [
        'uz' => "Mahsulot sevimlilarga qo'shildi!",
        'ru' => "–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ!",
        'en' => "Product added to favorites!",
    ];
    const DELETE_PRODUCT_FAVORTE_MESSAGE = [
        'uz' => "Mahsulot sevimlilardan olib tashlandi!",
        'ru' => "–¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ!",
        'en' => "Product removed from favorites!",
    ];
    const NOT_NEWS_MESSAGE = [
        'uz' => "Yangilik mavjud emas!",
        'ru' => "–ù–æ–≤–æ—Å—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞!",
        'en' => "News is not available!",
    ];
    const NOT_OFFER_MESSAGE = [
        'uz' => "Taklif mavjud emas!",
        'ru' => "–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ!",
        'en' => "Offer not available!",
    ];
    const STOP_ORDER_MESSAGE = [
        'uz' => "Buyurtma olish to'htatilgan!",
        'ru' => "–ó–∞–∫–∞–∑ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!",
        'en' => "Ordering is suspended!",
    ];
    const STOP_PAY_CARD_MESSAGE = [
        'uz' => "Bank kartasi orqali to'lov to'htatilgan!",
        'ru' => "–û–ø–ª–∞—Ç–∞ –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –∫–∞—Ä—Ç–æ–π –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞!",
        'en' => "Payment by bank card is suspended!",
    ];
    const STOP_PAY_BANK_MESSAGE = [
        'uz' => "Bank orqali to'lov to'htatilgan!",
        'ru' => "–ë–∞–Ω–∫–æ–≤—Å–∫–∏–π –ø–ª–∞—Ç–µ–∂ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!",
        'en' => "Bank payment is suspended!",
    ];
    const HIGH_CASHBACK_MESSAGE = [
        'uz' => "Keshbek juda baland kiritildi!",
        'ru' => "–ö—ç—à–±—ç–∫ –æ—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π!",
        'en' => "Cashback is very high!",
    ];
    const NOT_IN_STOCK_MESSAGE = [
        'uz' => "omborda mavjud emas!",
        'ru' => "–Ω–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏!",
        'en' => "out of stock!",
    ];
    const CALC_ORDER_MESSAGE = [
        'uz' => "Buyurtma hisoblandi!",
        'ru' => "–ó–∞–∫–∞–∑ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω!",
        'en' => "The order has been calculated!",
    ];
    const SAVE_ORDER_MESSAGE = [
        'uz' => "Buyurtma saqlandi!",
        'ru' => "–ó–∞–∫–∞–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!",
        'en' => "Order saved!",
    ];
    const NOT_ORDER_MESSAGE = [
        'uz' => "Buyurtma mavjud emas!",
        'ru' => "–ó–∞–∫–∞–∑ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω!",
        'en' => "Order not available!",
    ];
    const PAY_CONFIRM_ORDER_MESSAGE = [
        'uz' => "üü¢ To'lov tasdiqlandi!",
        'ru' => "üü¢ –û–ø–ª–∞—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞!",
        'en' => "üü¢ Payment confirmed!",
    ];
    const SENDED_ORDER_MESSAGE = [
        'uz' => "üîµ Jo'natildi!",
        'ru' => "üîµ–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!",
        'en' => "üîµ Sent!",
    ];
    const CLIENT_CANCEL_ORDER_MESSAGE = [
        'uz' => "üî¥ Buyurtmachi bekor qildi!",
        'ru' => "üî¥ –ö–ª–∏–µ–Ω—Ç –æ—Ç–º–µ–Ω–µ–Ω!",
        'en' => "üî¥ Customer canceled!",
    ];
    const OPERATOR_CANCEL_ORDER_MESSAGE = [
        'uz' => "üî¥ Operator bekor qildi!",
        'ru' => "üî¥ –û–ø–µ—Ä–∞—Ç–æ—Ä –æ—Ç–º–µ–Ω–∏–ª!",
        'en' => "üî¥ The operator canceled!",
    ];
    const YOUR_ORDER_MESSAGE = [
        'uz' => "Sizning buyurtmangiz!",
        'ru' => "–í–∞—à –∑–∞–∫–∞–∑!",
        'en' => "Your order!",
    ];
    const NOT_PHONE_MESSAGE = [
        'uz' => "Telefon raqam formati noto‚Äôg‚Äôri!",
        'ru' => "–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞!",
        'en' => "The phone number format is incorrect!",
    ];
    const SEND_SMS_MESSAGE = [
        'uz' => "SMS yuborildi!",
        'ru' => "–°–ú–° –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!",
        'en' => "SMS sent!",
    ];
    const BLOCK_TRY_AGAIN_MESSAGE = [
        'uz' => "Siz bloklandingiz, keyinroq urinib ko'ring!",
        'ru' => "–í—ã –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ!",
        'en' => "You are blocked, try again later!",
    ];
    const NOT_SMS_CODE_MESSAGE = [
        'uz' => "SMS kod mavjud emas!",
        'ru' => "–°–ú–°-–∫–æ–¥ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω!",
        'en' => "SMS code is not available!",
    ];
    const TRY_AGAIN_PHONE_MESSAGE = [
        'uz' => "Urinishlar soni tugadi, iltimos telefon nomerni qayta yuboring!",
        'ru' => "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –∏—Å—Ç–µ–∫–ª–æ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–∏—à–ª–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –µ—â–µ —Ä–∞–∑!",
        'en' => "The number of attempts has expired, please resend the phone number!",
    ];
    const WRONG_SMS_CODE_MESSAGE = [
        'uz' => "SMS kod noto'g'ri!",
        'ru' => "–ù–µ–≤–µ—Ä–Ω—ã–π SMS-–∫–æ–¥!",
        'en' => "The SMS code is incorrect!",
    ];
    const IN_LOGIN_MESSAGE = [
        'uz' => "Siz logindan o'tgansiz!",
        'ru' => "–í—ã –≤–æ—à–ª–∏ –≤ —Å–∏—Å—Ç–µ–º—É!",
        'en' => "You are logged in!",
    ];
    const USER_FIRST_DELETED_MESSAGE = [
        'uz' => "Brend avval o'chirilgan!",
        'ru' => "–ú–∞—Ä–∫–∞ —Ä–∞–Ω–µ–µ —É–¥–∞–ª–µ–Ω!",
        'en' => "Brand previously deleted!",
    ];
    const USER_DELETE_MESSAGE = [
        'uz' => "Brend o'chirildi!",
        'ru' => "–ú–∞—Ä–∫–∞ —É–¥–∞–ª–µ–Ω!",
        'en' => "Brand deleted!",
    ];

//    errors
//   bot texts

    const BOT_USER_NOT = [
        'uz' => "üë®‚ÄçüíªFoydalanuvchi mavjud emas!",
        'ru' => "üë®‚Äçüíª–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!",
        'en' => "üë®‚ÄçüíªThe user does not exist!",
    ];
    const BOT_ASK_PHONE = [
        'uz' => "Telefon raqamingizni yuboring",
        'ru' => "–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–≤–æ–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞",
        'en' => "Send your phone number",
    ];
    const BOT_SEND_PHONE = [
        'uz' => "Telefon raqamimni yuborish",
        'ru' => "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –º–æ–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞",
        'en' => "Send my phone number",
    ];
    const BOT_ORDER_TYPE = [
        'uz' => "Buyurtma turini tanlang:",
        'ru' => "–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∑–∞–∫–∞–∑–∞:",
        'en' => "Select the order type:",
    ];

    const BOT_ORDER_MIN_SUMMA = [
        'uz' => "‚ö†Ô∏è Buyurtma berish minimal summasi: ",
        'ru' => "‚ö†Ô∏è –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞: ",
        'en' => "‚ö†Ô∏è Minimum order amount: ",
    ];
    const BOT_BRANCH_CHANGE = [
        'uz' => "Shahar filiallaridan birini tanlang",
        'ru' => "–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –∏–∑ —Ñ–∏–ª–∏–∞–ª–æ–≤ –≥–æ—Ä–æ–¥–∞",
        'en' => "Choose one of the city branches",
    ];
    const BOT_STOP_ORDER = [
        'uz' => "‚ö†Ô∏è Hozircha buyurtma olish xizmati to'xtatilgan!",
        'ru' => "‚ö†Ô∏è –ü—Ä–∏–µ–º –∑–∞–∫–∞–∑–æ–≤ –≤—Ä–µ–º–µ–Ω–Ω–æ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!",
        'en' => "‚ö†Ô∏è The order receiving service has been suspended for now!",
    ];
    const BOT_STOP_DELIVERY = [
        'uz' => "‚ö†Ô∏è Hozircha yetkazib berish xizmati to'xtatilgan!\nBoshqa xizmatdan foydalanishingiz mumkin.",
        'ru' => "‚ö†Ô∏è –°–ª—É–∂–±–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞!\n–í—ã –º–æ–∂–µ—Ç–µ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥—Ä—É–≥–æ–π —Å–ª—É–∂–±–æ–π.",
        'en' => "‚ö†Ô∏è The delivery service is suspended for now!\nYou can use another service.",
    ];
    const BOT_STOP_PICK_UP = [
        'uz' => "‚ö†Ô∏è Hozircha olib ketish xizmati to'xtatilgan!\nBoshqa xizmatdan foydalanishingiz mumkin.",
        'ru' => "‚ö†Ô∏è –£—Å–ª—É–≥–∞ —Å–∞–º–æ–≤—ã–≤–æ–∑–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞!\n–í—ã –º–æ–∂–µ—Ç–µ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥—Ä—É–≥–æ–π —É—Å–ª—É–≥–æ–π.",
        'en' => "‚ö†Ô∏è Pickup service is suspended for now!\nYou can use another service.",
    ];
    const BOT_STOP_PAY_BANK = [
        'uz' => "‚ö†Ô∏è Hozircha Bank karta orqali to'lov xizmati to'xtatilgan!\nBoshqa xizmatdan foydalanishingiz mumkin.",
        'ru' => "‚ö†Ô∏è –£—Å–ª—É–≥–∞ –æ–ø–ª–∞—Ç—ã –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –∫–∞—Ä—Ç–æ–π –≤—Ä–µ–º–µ–Ω–Ω–æ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞!\n–í—ã –º–æ–∂–µ—Ç–µ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥—Ä—É–≥–æ–π —É—Å–ª—É–≥–æ–π.",
        'en' => "‚ö†Ô∏è Bank card payment service is suspended for now!\nYou can use another service.",
    ];
    const BOT_STOP_PAY_CASH = [
        'uz' => "‚ö†Ô∏è Hozircha Naqd pul orqali to'lov xizmati to'xtatilgan!\nBoshqa xizmatdan foydalanishingiz mumkin.",
        'ru' => "‚ö†Ô∏è –£—Å–ª—É–≥–∞ –æ–ø–ª–∞—Ç—ã –Ω–∞–ª–∏—á–Ω—ã–º–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞!\n–í—ã –º–æ–∂–µ—Ç–µ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥—Ä—É–≥–æ–π —É—Å–ª—É–≥–æ–π.",
        'en' => "‚ö†Ô∏è Cash payment service is suspended for now!\nYou can use another service.",
    ];
    const BOT_STOP_DISTANCE = [
        'uz' => "Sizning manzilingizga yetkazib berish mavjud emas! Iltimos, boshqa joyni belgilang!",
        'ru' => "–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –≤–∞—à–µ–º—É –∞–¥—Ä–µ—Å—É –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞! –£–∫–∞–∂–∏—Ç–µ –¥—Ä—É–≥–æ–µ –º–µ—Å—Ç–æ!",
        'en' => "Delivery to your address is not available! Please specify another location!",
    ];
    const BOT_CHANGE_DISTANCE = [
        'uz' => "Buyurtma manzili sifatida sizning turgan nuqtangiz tanlandi!",
        'ru' => "–í–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –±—ã–ª–æ –≤—ã–±—Ä–∞–Ω–æ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∞–¥—Ä–µ—Å–∞ –¥–ª—è –∑–∞–∫–∞–∑–∞!",
        'en' => "Your location has been selected as the order address!",
    ];
    const BOT_ASK_ADDRESS = [
        'uz' => "Ushbu manzilni tasdiqlaysizmi?",
        'ru' => "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —ç—Ç–æ—Ç –∞–¥—Ä–µ—Å?",
        'en' => "Confirm this address?",
    ];
    const BOT_MENU = [
        'uz' => "üîçTaomnomani ko‚Äôrish",
        'ru' => "üîç –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –º–µ–Ω—é",
        'en' => "üîç View the menu",
    ];
    const BOT_ABOUT = [
        'uz' => "‚ÑπÔ∏è Biz haqimizda",
        'ru' => "Ô∏è‚ÑπÔ∏è –û –Ω–∞—Å",
        'en' => "Ô∏è‚ÑπÔ∏è About us",
    ];
    const BOT_MY_ORDERS = [
        'uz' => "üìã Buyurtmalar tarixi",
        'ru' => "Ô∏èüìã –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤",
        'en' => "Ô∏èüìã History of orders",
    ];

    const BOT_TO_WORK = [
        'uz' => "üìÖ Ish jadvali",
        'ru' => "Ô∏èüìÖ –ì—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã",
        'en' => "Ô∏èüìÖ Work schedule",
    ];
    const BOT_FEEDBACK = [
        'uz' => "‚úçÔ∏è Fikr bildirish",
        'ru' => "‚úçÔ∏è –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π",
        'en' => "Ô∏è‚úçÔ∏è Comment",
    ];
    const BOT_SETTING = [
        'uz' => "‚öôÔ∏è Sozlamalar",
        'ru' => "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏",
        'en' => "Ô∏è‚öôÔ∏è Settings",
    ];
    const BOT_OR_TYPE_DEL = [
        'uz' => "üõµ Yetkazib berish",
        'ru' => "üõµ –î–æ—Å—Ç–∞–≤–∫–∞",
        'en' => "Ô∏èüõµ Delivery",
    ];
    const BOT_OR_TYPE_PICK_UP = [
        'uz' => "üö∂ Borib olish",
        'ru' => "üö∂ –ó–∞–±—Ä–∞—Ç—å",
        'en' => "Ô∏èüö∂ Pick up",
    ];
    const BOT_ASK_NO = [
        'uz' => "‚úñÔ∏è Yo'q",
        'ru' => "‚úñÔ∏è –ù–µ—Ç",
        'en' => "‚úñÔ∏è No",
    ];
    const BOT_ASK_YES = [
        'uz' => "‚úÖ Ha",
        'ru' => "‚úÖ –î–∞",
        'en' => "‚úÖ Yes",
    ];

    const BOT_ASK_OLD_YES = [
        'uz' => "‚úÖ Avvalgisidan foydalanish",
        'ru' => "‚úÖ –ò—Å–ø–æ–ª—å–∑—É—è –ø—Ä–µ–¥—ã–¥—É—â–∏–π",
        'en' => "‚úÖ Using the previous one",
    ];
    const BOT_MAKE_ORDER = [
        'uz' => "‚úÖ Buyurtma berish",
        'ru' => "‚úÖ –ó–∞–∫–∞–∑–∞—Ç",
        'en' => "‚úÖ Make order",
    ];
    const BOT_CLEAR_BASKET = [
        'uz' => "üõí Savatni tozalash üîÑ",
        'ru' => "üõí –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É üîÑ",
        'en' => "üõí Clear the basket üîÑ",
    ];
    const BOT_TO_MENU = [
        'uz' => "‚¨ÖÔ∏è Asosiy",
        'ru' => "‚¨ÖÔ∏è –û—Å–Ω–æ–≤–Ω–æ–µ",
        'en' => "‚¨ÖÔ∏è Home",
    ];
    const BOT_TO_BASKET = [
        'uz' => "üõí Savatga o'tish",
        'ru' => "üõí –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É",
        'en' => "üõí Go to cart",
    ];
    const BOT_START_TEXT = [
        'uz' => "Birga buyurtma beramiz!üöÄ\nMarhamat taomnoma va aksiyalarimiz bilan tanishishingiz mumkun!\n ",
        'ru' => "–ë—É–¥–µ–º –∑–∞–∫–∞–∑—ã–≤–∞—Ç—å –≤–º–µ—Å—Ç–µ!üöÄ\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –º–æ–∂–µ—Ç–µ –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –Ω–∞—à–∏–º –º–µ–Ω—é –∏ –∞–∫—Ü–∏—è–º–∏!\n ",
        'en' => "We will order together! üöÄ\nPlease, you can familiarize yourself with our menu and promotions!",
    ];

    const BOT_STOP_TEXT = [
        'uz' => "‚ö†Ô∏è Ushbu bot faoliyati vaqtincha to'xtatilgan!",
        'ru' => "‚ö†Ô∏è –†–∞–±–æ—Ç–∞ –±–æ—Ç–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞!",
        'en' => "‚ö†Ô∏è This bot is temporarily suspended!",
    ];
    const BOT_ASK_LANG = [
        'uz' => "So‚Äôzlashuv tilini tanlang!",
        'ru' => "–í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫ –æ–±—â–µ–Ω–∏—è!",
        'en' => "Choose the language of conversation!",
    ];
    const BOT_ASK_BRANCH_ORDER = [
        'uz' => "Qaysi filialimizga buyurtma bermoqchisiz?",
        'ru' => "–í –∫–∞–∫–æ–º –∏–∑ –Ω–∞—à–∏—Ö —Ñ–∏–ª–∏–∞–ª–æ–≤ –≤—ã —Ö–æ—Ç–µ–ª–∏ –±—ã —Å–¥–µ–ª–∞—Ç—å –∑–∞–∫–∞–∑?",
        'en' => "Which of our branches would you like to order from?",
    ];
    const BOT_NOT_BRANCHES = [
        'uz' => "‚ö†Ô∏è Filiallar mavjud emas!",
        'ru' => "‚ö†Ô∏è –í–µ—Ç–∫–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã!",
        'en' => "‚ö†Ô∏è Branches are not available!",
    ];
    const BOT_ASK_CATEGORY = [
        'uz' => "Taom turini tanlang:",
        'ru' => "–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –ø–∏—Ç–∞–Ω–∏—è:",
        'en' => "Select the type of food:",
    ];
    const BOT_NOT_CATEGORIES = [
        'uz' => "‚ö†Ô∏è Kategoriyalar mavjud emas!",
        'ru' => "‚ö†Ô∏è –ö–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–µ—Ç!",
        'en' => "‚ö†Ô∏è There are no categories!",
    ];
    const BOT_ADD_TO_BASKET = [
        'uz' => "‚ûï Savatga qo'shish",
        'ru' => "‚ûï –í –∫–æ—Ä–∑–∏–Ω—É",
        'en' => "‚ûï Add to cart",
    ];
    const BOT_MORE = [
        'uz' => "Batafsil",
        'ru' => "–ë–æ–ª–µ–µ",
        'en' => "More",
    ];
    const BOT_PRICE = [
        'uz' => "Narxi",
        'ru' => "–¶–µ–Ω–∞",
        'en' => "Price",
    ];
    const BOT_NOT_PRODUCTS = [
        'uz' => "‚ö†Ô∏è Mahsulotlar mavjud emas!",
        'ru' => "‚ö†Ô∏è –¢–æ–≤–∞—Ä–∞ –Ω–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏!",
        'en' => "‚ö†Ô∏è Products are not available!",
    ];
    const BOT_NOT_PRODUCT = [
        'uz' => "‚ö†Ô∏è Mahsulot mavjud emas!",
        'ru' => "‚ö†Ô∏è –¢–æ–≤–∞—Ä–∞ –Ω–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏!",
        'en' => "‚ö†Ô∏è Product not available!",
    ];
    const BOT_EMPTY_BASKET = [
        'uz' => "üõí Savat bo'sh!",
        'ru' => "üõí –ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞!",
        'en' => "üõí Cart is empty!",
    ];
    const BOT_BASKET_PRODUCTS = [
        'uz' => "üõí Savatdagi mahsulotlar",
        'ru' => "üõí –¢–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω–µ",
        'en' => "üõí Products in the basket",
    ];

    const BOT_PRODUCTS = [
        'uz' => "üõí Mahsulotlar",
        'ru' => "üõí –¢–æ–≤–∞—Ä—ã",
        'en' => "üõí Products",
    ];
    const BOT_TOTAL_SUMM = [
        'uz' => "üí∞ Jami summa",
        'ru' => "üí∞ –û–±—â–∞—è —Å—É–º–º–∞",
        'en' => "üí∞ Total amount",
    ];
    const BOT_CLEARED_BASKET = [
        'uz' => "‚ö†Ô∏è Savat tozalandi!",
        'ru' => "‚ö†Ô∏è –ö–æ—Ä–∑–∏–Ω–∞ –æ—á–∏—â–µ–Ω–∞!",
        'en' => "‚ö†Ô∏è Cart cleared!",
    ];
    const BOT_ASK_FOR_DELIVERY = [
        'uz' => "Yetkazib berish uchun geo-joylashuvni yuboring",
        'ru' => "–£–∫–∞–∂–∏—Ç–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏",
        'en' => "Submit geo-location for delivery",
    ];
    const BOT_ASK_FOR_PICK_UP = [
        'uz' => "Borib olish uchun geo-joylashuvni jo'nating, sizga yaqin bo'lgan filialni aniqlaymiz",
        'ru' => "–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–≤–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ, —á—Ç–æ–±—ã –∑–∞–±—Ä–∞—Ç—å, –∏ –º—ã –Ω–∞–π–¥–µ–º –±–ª–∏–∂–∞–π—à–∏–π –∫ –≤–∞–º —Ñ–∏–ª–∏–∞–ª",
        'en' => "Submit your geo-location to pick up and we'll locate a branch near you",
    ];
    const BOT_SEND_LOCATION = [
        'uz' => "üìç Geolokatsiyani yuborish",
        'ru' => "üìç –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é",
        'en' => "üìç Send geolocation",
    ];
    const BOT_ORDER_PAY_BANK = [
        'uz' => "üí≥ Bank karta",
        'ru' => "üí≥ –ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞",
        'en' => "üí≥ Bank card",
    ];
    const BOT_ORDER_PAY_CASH = [
        'uz' => "üíµ Naqd pul",
        'ru' => "üíµ –ù–∞–ª–∏—á–Ω—ã–µ",
        'en' => "üíµ Cash",
    ];
    const BOT_CHANGE_PAY_ACCEPT = [
        'uz' => "üí≥ To'lov turini tanlang va buyurtma tasdiqlanadi!",
        'ru' => "üí≥ –í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã –∏ –∑–∞–∫–∞–∑ –±—É–¥–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω!",
        'en' => "üí≥ Select the payment type and the order will be confirmed!",
    ];
    const BOT_DELIVERY_SUMM = [
        'uz' => "üõµ Yetkazib berish summasi",
        'ru' => "üõµ –°—É–º–º–∞ –¥–æ—Å—Ç–∞–≤–∫–∏",
        'en' => "üõµ Delivery amount",
    ];

    const BOT_DELIVERY_TAXI = [
        'uz' => "Yetkazilganda hisoblanadi!",
        'ru' => "–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –¥–æ—Å—Ç–∞–≤–∫–µ!",
        'en' => "Calculated when delivered!",
    ];
    const BOT_PRODUCTS_SUMM = [
        'uz' => "üõç Mahsulotlar summasi",
        'ru' => "üõç –°—É–º–º–∞ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–π",
        'en' => "üõç Sum of products",
    ];
    const BOT_ADDRESS = [
        'uz' => "üìç Manzil koordinatalari",
        'ru' => "üìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∞–¥—Ä–µ—Å–∞",
        'en' => "üìç Address coordinates",
    ];
    const BOT_ORDER_SAVED = [
        'uz' => "üõç Buyurtmangiz muvaffaqiyatli yuborildi! Tez orada buyurtma holati haqida xabar qabul qilasiz!",
        'ru' => "üõç –í–∞—à –∑–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! –í—Å–∫–æ—Ä–µ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Å—Ç–∞—Ç—É—Å–µ –∑–∞–∫–∞–∑–∞!",
        'en' => "üõç Your order has been sent successfully! You will receive an order status message soon!",
    ];


    const BOT_ORDER_NEW = [
        'uz' => "tekshirilmoqda...",
        'ru' => "–ø—Ä–æ–≤–µ—Ä–∫–∞...",
        'en' => "checking...",
    ];

    const BOT_HAVE_NEW_ORDER = [
        'uz' => "Yangi buyurtma mavjud!",
        'ru' => "–ï—Å—Ç—å –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑!",
        'en' => "There is a new order!",
    ];

    const BOT_ACCEPT_PAYMENT = [
        'uz' => "To'lovingiz tasdiqlandi!",
        'ru' => "–í–∞—à –ø–ª–∞—Ç–µ–∂ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω!",
        'en' => "Your payment has been confirmed!",
    ];

    const BOT_REJECT_PAYMENT = [
        'uz' => "To'lovingiz bekor qilindi!",
        'ru' => "–í–∞—à –ø–ª–∞—Ç–µ–∂ –±—ã–ª –æ—Ç–º–µ–Ω–µ–Ω!",
        'en' => "Your payment has been cancelled!",
    ];

    const BOT_HAVE_ARREARAGE = [
        'uz' => "Sizda qarzdorlik mavjud!",
        'ru' => "–£ —Ç–µ–±—è –µ—Å—Ç—å –¥–æ–ª–≥!",
        'en' => "You have debt!",
    ];

    const BOT_ORDER_ACCEPT = [
        'uz' => "tasdiqlandi",
        'ru' => "–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–π",
        'en' => "confirmed",
    ];
    const BOT_ORDER_PROCESSING = [
        'uz' => "jarayonda",
        'ru' => "–≤ —Ö–æ–¥–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è",
        'en' => "in progress",
    ];

    const BOT_ORDER_CONNECTED = [
        'uz' => "yo'lda...",
        'ru' => "–≤ –ø—É—Ç–∏...",
        'en' => "on the way...",
    ];
    const BOT_ORDER_SENDED = [
        'uz' => "jo'natildi",
        'ru' => "–æ—Ç–ø—Ä–∞–≤–∏–ª",
        'en' => "sent",
    ];
    const BOT_ORDER_COMPLETED = [
        'uz' => "muvaffaqiyatli tugatildi",
        'ru' => "–∑–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ",
        'en' => "completed successfully",
    ];
    const BOT_ORDER_OPERATOR_CANCEL = [
        'uz' => "operator bekor qildi",
        'ru' => "–æ–ø–µ—Ä–∞—Ç–æ—Ä –æ—Ç–º–µ–Ω–∏–ª",
        'en' => "the operator canceled",
    ];
    const BOT_PAY_WITH_BANK = [
        'uz' => "Bank kartasi orqali",
        'ru' => "–ë–∞–Ω–∫–æ–≤—Å–∫–æ–π –∫–∞—Ä—Ç–æ–π",
        'en' => "By bank card",
    ];
    const BOT_PAY_WITH_CASH = [
        'uz' => "Naqd pul orqali",
        'ru' => "–ù–∞–ª–∏—á–Ω—ã–º–∏",
        'en' => "By cash",
    ];
    const BOT_PAY_TYPE = [
        'uz' => "üí≤ To'lov turi",
        'ru' => "üí≤ –¢–∏–ø –æ–ø–ª–∞—Ç—ã",
        'en' => "üí≤ Payment type",
    ];

    const BOT_DELIVERY_TYPE = [
        'uz' => "Yetkazib berish turi",
        'ru' => "üí≤ –¢–∏–ø –æ–ø–ª–∞—Ç—ã",
        'en' => "üí≤ Payment type",
    ];
    const BOT_STATUS = [
        'uz' => "Holat",
        'ru' => "–ü–æ–ª–æ–∂–µ–Ω–∏–µ –¥–µ–ª",
        'en' => "Status",
    ];
    const BOT_YOUR_ORDER = [
        'uz' => "Sizning buyurtmangiz",
        'ru' => "–¢–≤–æ—è –∑–∞–∫–∞–∑–∞",
        'en' => "Your order",
    ];
    const BOT_NUMBER_ORDER = [
        'uz' => "Buyurtma raqami",
        'ru' => "–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞",
        'en' => "Order number",
    ];

    const BOT_YOUR_BALANCE = [
        'uz' => "Sizning balansingizda mavjud",
        'ru' => "–î–æ—Å—Ç—É–ø–Ω–æ –Ω–∞ –≤–∞—à–µ–º –±–∞–ª–∞–Ω—Å–µ",
        'en' => "Available in your balance",
    ];
    const BOT_TIME = [
        'uz' => "üïê Vaqti",
        'ru' => "üïê –í—Ä–µ–º—è",
        'en' => "üïê Time",
    ];
    const BOT_CHANGE_ONE = [
        'uz' => "Quyidagilardan birini tanlang",
        'ru' => "–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö",
        'en' => "Choose one of the following",
    ];
    const BOT_NOT_ORDERS = [
        'uz' => "üõç Buyurtmalar mavjud emas!",
        'ru' => "üõç –ó–∞–∫–∞–∑–æ–≤ –Ω–µ—Ç!",
        'en' => "üõç Orders are not available!",
    ];
    const BOT_TO_BACK = [
        'uz' => "‚¨ÖÔ∏è Ortga",
        'ru' => "‚¨ÖÔ∏è –ù–∞–∑–∞–¥",
        'en' => "‚¨ÖÔ∏è Back",
    ];

    const BOT_GET_LANG = [
        'uz' => "Muloqot tili",
        'ru' => "–Ø–∑—ã–∫",
        'en' => "Language",
    ];

    const BOT_GET_PHONE = [
        'uz' => "Telefon",
        'ru' => "–¢–µ–ª–µ—Ñ–æ–Ω",
        'en' => "Phone",
    ];
    const BOT_GET_BRANCH = [
        'uz' => "Shahar",
        'ru' => "–ì–æ—Ä–æ–¥",
        'en' => "Region",
    ];
    const BOT_CHANGE_LANG = [
        'uz' => "Tilni o'zgartirish",
        'ru' => "–ò–∑–º–µ–Ω–∏—Ç—å —è–∑—ã–∫",
        'en' => "Change the language",
    ];

    const BOT_CHANGE_PHONE = [
        'uz' => "Telefonni o'zgartirish",
        'ru' => "–°–º–µ–Ω–∏—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω",
        'en' => "Change the phone",
    ];
    const BOT_CHANGE_BRANCH = [
        'uz' => "Shaharni o'zgartirish",
        'ru' => "–ò–∑–º–µ–Ω–∏—Ç—å –≥–æ—Ä–æ–¥",
        'en' => "Change region",
    ];
    const BOT_ASK_FEEDBACK = [
        'uz' => "Fikr va mulohazalaringizni yuboring",
        'ru' => "–ü—Ä–∏—Å—ã–ª–∞–π—Ç–µ —Å–≤–æ–∏ –º—ã—Å–ª–∏ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏",
        'en' => "Submit your thoughts and comments",
    ];
    const BOT_SAVED = [
        'uz' => "Yuborildi! Sizga xizmat ko'rsatishdan mamnunmiz!",
        'ru' => "–û—Ç–ø—Ä–∞–≤–∏–ª! –ú—ã —Ä–∞–¥—ã —Å–ª—É–∂–∏—Ç—å –≤–∞–º!",
        'en' => "Sent! We are happy to serve you!",
    ];

    const BOT_NOT_ORDER_DAY = [
        'uz' => "Afsuski, bugun buyurtmalar qabul qilinmaydi!",
        'ru' => "–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —Å–µ–≥–æ–¥–Ω—è –∑–∞–∫–∞–∑—ã –Ω–µ –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è!",
        'en' => "Unfortunately, orders are not accepted today!",
    ];

    const BOT_NOT_ORDER_TIME = [
        'uz' => "Buyurtmalar qabul qilish vaqt oralig'i: ",
        'ru' => "–°—Ä–æ–∫–∏ –ø—Ä–∏–µ–º–∞ –∑–∞–∫–∞–∑–æ–≤: ",
        'en' => "Time frame for receiving orders: ",
    ];

    const BOT_PHONE_FOR_CONNECT = [
        'uz' => "Bog'lanish uchun telefon raqam: ",
        'ru' => "–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω: ",
        'en' => "Contact phone number: ",
    ];

    const BOT_PHONE_FOR_SUPPORT = [
        'uz' => "Texnik yordam uchun telefon raqam: ",
        'ru' => "–¢–µ–ª–µ—Ñ–æ–Ω –¥–ª—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏: ",
        'en' => "Phone number for technical support: ",
    ];

    const BOT_NOT_ORDER_DAYS = [
        'uz' => "Buyurtmalar qabul qilish kunlari: ",
        'ru' => "–î–Ω–∏ –ø—Ä–∏–µ–º–∞ –∑–∞–∫–∞–∑–æ–≤: ",
        'en' => "Days of receiving orders: ",
    ];


    const BOT_WEEK_DAY_MON = [
        'uz' => "Dushanba",
        'ru' => "–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫",
        'en' => "Monday",
    ];

    const BOT_WEEK_DAY_TUE = [
        'uz' => "Seshanba",
        'ru' => "–í—Ç–æ—Ä–Ω–∏–∫",
        'en' => "Tuesday",
    ];

    const BOT_WEEK_DAY_WED = [
        'uz' => "Chorshanba",
        'ru' => "–°—Ä–µ–¥–∞",
        'en' => "Wednesday",
    ];

    const BOT_WEEK_DAY_THU = [
        'uz' => "Payshanba",
        'ru' => "–ß–µ—Ç–≤–µ—Ä–≥",
        'en' => "Thursday",
    ];

    const BOT_WEEK_DAY_FRI = [
        'uz' => "Juma",
        'ru' => "–ü—è—Ç–Ω–∏—Ü–∞",
        'en' => "Friday",
    ];

    const BOT_WEEK_DAY_SAT = [
        'uz' => "Shanba",
        'ru' => "–°—É–±–±–æ—Ç–∞",
        'en' => "Saturday",
    ];

    const BOT_WEEK_DAY_SUN = [
        'uz' => "Yakshanba",
        'ru' => "–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ",
        'en' => "Sunday",
    ];

    const BOT_FULL_VIEW = [
        'uz' => "üëÅ‚Äçüó® To'liq ko'rish",
        'ru' => "üëÅ‚Äçüó® –ü–æ–ª–Ω—ã–π –æ–±–∑–æ—Ä",
        'en' => "üëÅ‚Äçüó® Full view",
    ];


//   bot texts

    public function sendResponse($result, $success = NULL, $message = NULL, $error_code = 0)
    {
        $response = [
            'success' => $success,
            'data' => $result,
            'message' => $message,
            'error_code' => $error_code,

        ];

        return response()->json($response, 200);
    }

    public function getApiKey()
    {

        $headers = getallheaders();
        return (isset($headers['Key'])) ? $headers['Key'] : 'no_key';
    }

    public function getLang()
    {
        $headers = getallheaders();
        return (isset($headers['Lang'])) ? $headers['Lang'] : 'uz';
    }

    public function getToken()
    {

        $headers = getallheaders();
        return (isset($headers['Token'])) ? $headers['Token'] : 'no_token';
    }

    public function user()
    {
        return AppUser::where('token', $this->getToken())->first();
    }

    public function checkBranchOrderCount($branch_id, $order_id)
    {

//        tariffs
//        max_month_order_counts
        $free = 100;
        $low = 1000;
        $medium = 2000;
//        max_month_order_counts
//        out_limit_one_order_summa
        $free_summa = 0;
        $low_summa = 1500;
        $medium_summa = 1200;
        $high_summa = 1000;
//        out_limit_one_order_summa

        $branch = Branch::where(['id' => $branch_id, 'status' => 'active'])->first();

        if ($branch != null){
            $branch->update([
                'full_order_count' => $branch->full_order_count + 1
            ]);
        }

    }

    public function sendBot($method, $datas = [], $brand_id = null)
    {
        $key = self::BOT_TOKEN;
        if ($brand_id != null) {
            $brand = Brand::where('id', $brand_id)->first();
            if ($brand != null) {
                $bot = Bot::where(['brand_id' => $brand->id, 'status' => 'active'])->first();
                if ($bot != null) {
                    $key = $bot->bot_token;
                }
            }
        }
        $url = "https://api.telegram.org/bot" . $key . "/" . $method;
        $ch = curl_init();
        curl_setopt($ch, CURLOPT_URL, $url);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
        curl_setopt($ch, CURLOPT_POSTFIELDS, $datas);

        $res = curl_exec($ch);
        if (curl_error($ch)) {
            var_dump(curl_error($ch));
        } else {
            return json_decode($res);
        }
    }

    public function getButtons($order_or_user_id, $button_text, $status, $type)
    {
        $button = [
            'text' => $button_text,
            'callback_data' => json_encode(array("id" => $order_or_user_id, "st" => $status, "tp" => $type))
        ];
        return $button;
    }


    function sendPaymentToSocket($brand_id, $branch_id, $summa, $type){
        $branch = Branch::where(['id' => $branch_id, 'status' => 'active'])->first();
//        $check_arrearage = false;
//        if($branch != null && $branch->arrearage > 0){
//            $check_arrearage = true;
//        }
        $control_users = ControlUser::whereNotNull('socket_id')->where([
            'brand_id' => $brand_id,
            'branch_id' => $branch_id,
            'allow_app_order' => 1,
        ])->get();
        $socket_url = Controller::SOCKET_BASE_URL;
        $send_url = $socket_url . "accept_payment";
        $client = new GuzzleHttp\Client();

        foreach ($control_users as $control_user) {
            $response = [
                'user_socket_id' => $control_user->socket_id,
            ];
            $data = $client->post($send_url, [
                'json' => $response,
            ]);

            $lang = $control_user->lang != null ? $control_user->lang : "uz";

            // send fcm
            $your_payment = "";
            if ($type == "accepted"){
                $your_payment = Controller::BOT_ACCEPT_PAYMENT[$lang];
            }else{
                $your_payment = Controller::BOT_REJECT_PAYMENT[$lang];
            }
            $summa = Controller::BOT_YOUR_BALANCE[$lang] . ": $summa SUM";
            Controller::sendFCM("$your_payment", $summa, "notify", "payment", $control_user->fcm_token, $control_user->lang);
            // send fcm
        }

        return 0;
    }


    public function sendToSocket($brand_id, $branch_id, $order_id = 0)
    {

        $branch = Branch::where(['id' => $branch_id, 'status' => 'active'])->first();
        $check_arrearage = false;
        if($branch != null && $branch->balance < 0){
            $check_arrearage = true;
        }
        $control_users = ControlUser::whereNotNull('socket_id')->where([
            'brand_id' => $brand_id,
            'branch_id' => $branch_id,
            'allow_app_order' => 1,
        ])->get();
        $socket_url = self::SOCKET_BASE_URL;
        $send_url = $socket_url . "send_order";
        $client = new GuzzleHttp\Client();

        foreach ($control_users as $control_user) {
            $response = [
                'user_socket_id' => $control_user->socket_id,
                'status' => "new_order",
            ];
            $data = $client->post($send_url, [
                'json' => $response,
            ]);

            $lang = $control_user->lang != null ? $control_user->lang : "uz";
            $have_arrearage = "";
            if($check_arrearage){
                $have_arrearage = self::BOT_HAVE_ARREARAGE[$lang];
            }
            // send fcm
            $new_order = self::BOT_HAVE_NEW_ORDER[$lang];
            $order_number = self::BOT_NUMBER_ORDER[$lang] . ": $order_id";
            $this->sendFCM("$new_order $have_arrearage", $order_number, "new_order", "new_order", $control_user->fcm_token, $control_user->lang);
            // send fcm
        }
        return 0;
    }

    public function sendFCM($title, $content, $content_type, $send_type, $fcm_token, $lang = null)
    {
        if ($send_type == 'all') {
            $to = "/topics/news_" . $lang;
            $data = array(
                "to" => $to,
                "notification" => array(
                    "title" => $title,
                    "body" => $content
                ),
                "data" => array(
                    "type" => $content_type,
                ));

            $data_string = json_encode($data);
            // echo "The Json Data : ".$data_string;
            try {
                $headers = array('Authorization: key=' . self::API_ACCESS_KEY, 'Content-Type: application/json');
                $ch = curl_init();
                curl_setopt($ch, CURLOPT_URL, 'https://fcm.googleapis.com/fcm/send');
                curl_setopt($ch, CURLOPT_POST, true);
                curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
                curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
                curl_setopt($ch, CURLOPT_POSTFIELDS, $data_string);
                $result = curl_exec($ch);
                curl_close($ch);
            } catch (\Throwable $th) {
            }

        } else {
            $data = array(
                "to" => $fcm_token,
                "data" => array(
                    "type" => $content_type,
                    "title" => $title,
                    "body" => $content
                ));

            $data_string = json_encode($data);
            // echo "The Json Data : ".$data_string;
            try {
                $headers = array('Authorization: key=' . self::API_ACCESS_KEY, 'Content-Type: application/json');
                $ch = curl_init();
                curl_setopt($ch, CURLOPT_URL, 'https://fcm.googleapis.com/fcm/send');
                curl_setopt($ch, CURLOPT_POST, true);
                curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
                curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
                curl_setopt($ch, CURLOPT_POSTFIELDS, $data_string);
                $result = curl_exec($ch);
                curl_close($ch);
            } catch (\Throwable $th) {
            }
        }
    }
}
